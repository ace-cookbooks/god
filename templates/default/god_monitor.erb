# Generated by Chef

keepalive_options = {}
<% if @memory_max -%>
  keepalive_options[:memory_max] = <%= @memory_max %>
<% end -%>
<% if @cpu_max -%>
  keepalive_options[:cpu_max] = <%= @cpu_max %>
<% end -%>


God.watch do |w|
  w.name = '<%= @name %>'
  <% if @group -%>
  w.group = '<%= @group %>'
  <% end -%>
  w.start = '<%= @start_command %>'
  w.stop = '<%= @stop_command %>'
  <% if @restart_command -%>
  w.restart = '<%= @restart_command %>'
  <% end -%>

  <% if @pid_file -%>
  w.pid_file = '<%= @pid_file %>'
  w.behavior(:clean_pid_file)
  <% end -%>

  <% if @env -%>
    w.env = { <%= @env.reduce(''){|str,hash| str << "'#{hash.first}' => '#{hash.last}', "} %>}
  <% end -%>

  w.keepalive(keepalive_options)

  w.lifecycle do |on|
    on.condition(:flapping) do |c|
      c.to_state = [:start, :restart]
      c.times = 5
      c.within = 5.minute
      c.transition = :unmonitored
      c.retry_in = 10.minutes
      c.retry_times = 5
      c.retry_within = 2.hours
    end
  end
end
